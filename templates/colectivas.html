{% extends "base.html" %}
{% block title %}Salidas Colectivas{% endblock %}

{% block content %}
<section class="form-section Colectivas">
    <h2 class="text-info mb-4">Salida Colectivas</h2>

    <form method="post" class="bg-dark p-4 rounded shadow">
        <fieldset>
            <legend class="text-light mb-4">Nueva Colectivas</legend>

            <!-- Medicamentos (1 a 3) -->
            {% for i in range(1,4) %}
            <div class="row g-3 mb-2">
                <div class="col-md-8">
                    <input type="text" name="medicamento{{ i }}" class="form-control bg-secondary text-light border-0" placeholder="Medicamento {{ i }}{% if i > 1 %} (opcional){% endif %}">
                </div>
                <div class="col-md-4">
                    <input type="number" name="cantidad{{ i }}" class="form-control bg-secondary text-light border-0" placeholder="Cantidad {{ i }}{% if i > 1 %} (opcional){% endif %}" min="1">
                </div>
            </div>
            {% endfor %}

            <!-- Tipo de cooperativa -->
            <div class="row g-3 mt-3">
                <div class="col-md-6">
                    <select name="tipo" class="form-select bg-secondary text-light border-0" required onchange="updateResponsables(this.value)">
                        <option value="" disabled selected>Seleccione tipo</option>
                        {% for tipo in responsables.keys() %}
                            <option value="{{ tipo }}">{{ tipo }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <select name="responsable" id="responsableSelect" class="form-select bg-secondary text-light border-0" required>
                        <option value="" disabled selected>Seleccione responsable</option>
                    </select>
                </div>
            </div>

            <!-- Doctor -->
            <div class="row g-3 mt-3">
                <div class="col-md-6">
                    <select name="doctor" class="form-select bg-secondary text-light border-0" required>
                        <option value="" disabled selected>Seleccione doctor</option>
                        {% for d in doctores %}
                            <option value="{{ d }}">{{ d }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <p class="info-label text-muted mt-3">La fecha y hora actual se registrarán automáticamente</p>

            <div class="mt-3">
                <button type="submit" class="btn btn-primary">Registrar Colectivas</button>
            </div>
        </fieldset>
    </form>

    <!-- Historial -->
    <h3 class="mt-5 text-info">Historial de Colectivas</h3>
    <table class="table table-dark table-striped table-hover mt-3">
        <thead class="table-secondary text-dark">
            <tr>
                <th>Medicamento</th>
                <th>Cantidad</th>
                <th>Tipo</th>
                <th>Responsable</th>
                <th>Doctor</th>
                <th>Fecha</th>
            </tr>
        </thead>
        <tbody>
            {% for c in Colectivas %}
            <tr>
                <td>{{ c.medicamento }}</td>
                <td>{{ c.cantidad }}</td>
                <td>{{ c.tipo }}</td>
                <td>{{ c.responsable }}</td>
                <td>{{ c.doctor }}</td>
                <td>{{ c.fecha }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" class="text-center text-muted">No hay salidas Colectivas registradas</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<script>
function updateResponsables(tipo) {
    const responsables = {{ responsables|tojson }};
    const select = document.getElementById("responsableSelect");
    select.innerHTML = '<option value="" disabled selected>Seleccione responsable</option>';
    if (responsables[tipo]) {
        responsables[tipo].forEach(r => {
            const opt = document.createElement("option");
            opt.value = r;
            opt.textContent = r;
            select.appendChild(opt);
        });
    }
}
</script>
{% endblock %}
