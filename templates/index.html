<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Medicamentos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <h1>Sistema de Gestión de Medicamentos</h1>
    </header>

    <!-- Sección Ingreso -->
    <section class="form-section ingresos">
        <h2>Ingreso de Medicamentos</h2>
        <form action="{{ url_for('agregar_ingreso') }}" method="post" class="form-grid">
            <fieldset>
                <legend>Nuevo Ingreso</legend>
                <input type="text" name="medicamento" placeholder="Medicamento" required>
                <input type="number" name="cantidad" placeholder="Cantidad" required>

                <select name="tipo" required>
                    <option value="" disabled selected>Seleccione tipo</option>
                    {% for t in tipos %}
                        <option value="{{ t }}">{{ t }}</option>
                    {% endfor %}
                </select>

                <p class="info-label">La fecha y hora actual se registrarán automáticamente</p>
                <button type="submit">Registrar Ingreso</button>
            </fieldset>
        </form>

        <h3>Historial de Ingresos</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Medicamento</th>
                    <th>Cantidad</th>
                    <th>Tipo</th>
                    <th>Fecha y Hora</th>
                </tr>
            </thead>
            <tbody>
                {% for i in ingresos %}
                <tr>
                    <td>{{ i.medicamento }}</td>
                    <td>{{ i.cantidad }}</td>
                    <td>{{ i.tipo }}</td>
                    <td>{{ i.fecha }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- Sección Salida -->
    <section class="form-section salidas">
        <h2>Salida de Medicamentos</h2>
        <form action="{{ url_for('agregar_salida') }}" method="post" class="form-grid">
            <fieldset>
                <legend>Nueva Salida</legend>
                {% for i in range(1,6) %}
                    <input type="text" name="medicamento{{ i }}" 
                           placeholder="Medicamento {{ i }}{% if i > 1 %} (opcional){% endif %}" 
                           {% if i == 1 %}required{% endif %}>
                    <input type="number" name="cantidad{{ i }}" 
                           placeholder="Cantidad {{ i }}{% if i > 1 %} (opcional){% endif %}" 
                           {% if i == 1 %}required{% endif %}>
                {% endfor %}

                <select name="responsable" required>
                    <option value="" disabled selected>Seleccione responsable</option>
                    {% for r in responsables %}
                        <option value="{{ r }}">{{ r }}</option>
                    {% endfor %}
                </select>

                <input type="text" name="paciente" placeholder="Paciente" required>

                <select name="modulo" required>
                    <option value="" disabled selected>Seleccione módulo</option>
                    {% for m in modulos %}
                        <option value="{{ m }}">{{ m }}</option>
                    {% endfor %}
                </select>

                <p class="info-label">La fecha y hora actual se registrarán automáticamente</p>
                <button type="submit">Registrar Salida</button>
            </fieldset>
        </form>

        <h3>Historial de Salidas</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Medicamentos</th>
                    <th>Responsable</th>
                    <th>Paciente</th>
                    <th>Módulo</th>
                    <th>Fecha y Hora</th>
                </tr>
            </thead>
            <tbody>
                {% for registro in salidas %}
                <tr>
                    <td>
                        <ul>
                            {% for m in registro.meds %}
                                <li>{{ m.nombre }} ({{ m.cantidad }})</li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td>{{ registro.responsable }}</td>
                    <td>{{ registro.paciente }}</td>
                    <td>{{ registro.modulo }}</td>
                    <td>{{ registro.fecha }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- Sección Stock -->
    <section class="form-section stock">
        <h2>Stock Actual</h2>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Medicamento</th>
                    <th>Cantidad</th>
                    <th>Última actualización</th>
                </tr>
            </thead>
            <tbody>
                {% for nombre, datos in stock.items() %}
                <tr>
                    <td>{{ nombre }}</td>
                    <td>{{ datos.cantidad }}</td>
                    <td>{{ datos.ultima_actualizacion }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

</body>
</html>
